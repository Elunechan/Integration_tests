# Integration Autotests



## Как начать? Установка всех библиотек и Allure отчетов

### Для начала и запуска проекта, необходимо сделать следующее:
1. Установить [PyCharm Community Edition](https://www.jetbrains.com/pycharm/)  + [Python 3](https://www.python.org/)
2. Открыть в PyCharm терминал и установить библиотеки из файла pyproject.toml c помощью команды  `pip install .`
3. Установить хром браузер для Playwright с помощью команды `playwright install chromium` (если необходимы другие браузеры, то просто playwright install)

### Теперь можно писать и запускать тесты локально. Но для генерации красивых Allure отчетов необходимо сделать некоторые действия:

1. Заходим в Powershell с правами администратора и устанавливаем политику `Set-ExecutionPolicy RemoteSigned -Scope CurrentUser`
2. Устанавливаем менеджер пакетов для Windows `irm get.scoop.sh | iex` (Начиная с этого шага продолжаем в терминале PyCharm)
3. Устанавливаем JDK и Allure двумя командами по очереди `scoop bucket add java` и `scoop install temurin-jdk allure`

Теперь у вас установлены JDK и Allure, которые позволяют использовать данные консольные программы в терминале. Если возникает проблема "Не найдена команда Allure", то проверьте что у вас настроены PATH на JDK и Allure
 
### Как запустить все тесты и открыть Allure отчет

1. Для запуска всех тестов и генерации Allure отчета используем команду `pytest tests/ --alluredir=allure-results` она запускает все тесты в подпапках tests/
2. Открываем Allure отчет в браузере с помощью команды `allure serve allure-results`
3. Важно! Перед каждым запуском обязательно чистите папку allure-results, иначе у вас "слипнуться" все отчеты.

### Как запстить тесты локально и другие нюансы отладки

- Что бы точечно запустить определенный тест, необходимо использовать команду `pytest tests/api/*название файла*.py` для запуска функции внутри файла `pytest tests/ui/*название файла*.py::*функция внутри файла* -v`
- Для добавления логов в API тестах используйте фикстуру log_response из conftest.py
- Для запуска браузера в пошаговом режиме используйте команду `$env:PWDEBUG="1"; pytest tests/ui/ --headed -s`